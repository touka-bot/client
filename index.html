<!DOCTYPE html>
<html>

<head>
    <title>FLUID v2</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <input type="text" class="search-input" id="center" placeholder="Search a Show">
    <button id="center" class="search-button" onclick="searchTitle()">Search</button>
</body>

<script>
    function searchTitle() {
        var elementX = document.getElementsByClassName("animeSelection");
        console.log(elementX.length);
        for (let i = 0; i < elementX.length; i++) {
            elementX.item(i).parentNode.removeChild(elementX.item(i));
        }
        var show = document.getElementsByClassName('search-input')[0].value;
        if (show == "")
            return alert('Please enter a Show');

        const Http = new XMLHttpRequest();
        const url = 'http://4c3711.xyz:3000/fluid/api/v1/search/' + show.toLowerCase().replace(" ", "+");
        Http.open("GET", url);
        Http.send();

        Http.onreadystatechange = (e) => {
            
            const repoArray = JSON.parse(Http.responseText);
            console.log(`${repoArray.length} | ${Http.responseText}`);
            
            for (let i = 0; i < repoArray.length; i++) {
                var btn = document.createElement("BUTTON");
                btn.innerHTML = repoArray[i].replace("https://4anime.to/anime/", "").replace("-", " "); // Insert text
                btn.setAttribute("onclick", `getEpisodes("${show.toLowerCase().replace(" ", "+")}", ${i})`);
                btn.setAttribute("class", "animeSelection");
                document.body.appendChild(btn); // Append <button> to <body>
            }
        }
    }

    function getEpisodes(title, index) {
        const HttpW = new XMLHttpRequest();
        const url = `http://4c3711.xyz:3000/fluid/api/v1/search/${title}/${index}`;
        HttpW.open("GET", url);
        HttpW.send();

        HttpW.onreadystatechange = (e) => {
            let repoArray = new Array();
            console.log(HttpW.responseText);
            repoArray = JSON.parse(HttpW.responseText);
            for (let i = 0; i < repoArray.length; i++) {
                var btn = document.createElement("BUTTON"); // Create a <button> element
                btn.innerHTML = `EP ${i}`; // Insert text
                btn.setAttribute("onclick", `window.location.href='${repoArray[i]}'`);
                document.body.appendChild(btn); // Append <button> to <body>
            }
        }
    }
</script>

</html>